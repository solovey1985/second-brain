
<!DOCTYPE html>
<html lang="en">
<head>
  <meta version="1.0.1">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>final-implementation-guide - Documentation Portal</title>
  
  <!-- External Stylesheet -->
  <link rel="stylesheet" type="text/css" href="/second-brain/app.css">
  
  <!-- Highlight.js CSS for syntax highlighting -->
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github.min.css">

  <!-- Mermaid for diagrams -->
  <script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true, theme: 'default' });
  </script>
  
</head>
<body data-base-url="/second-brain">
  <!-- Mobile Menu Toggle Button -->
  <button class="mobile-menu-toggle" aria-label="Toggle navigation menu" aria-expanded="false">
  </button>
  
  <!-- Mobile Overlay -->
  <div class="mobile-overlay"></div>
  
  <!-- Image Lightbox -->
  <div id="image-lightbox" class="lightbox" style="display: none;">
    <div class="lightbox-overlay"></div>
    <div class="lightbox-content">
      <button class="lightbox-close" aria-label="Close lightbox">&times;</button>
      <button class="lightbox-prev" aria-label="Previous image">&#8249;</button>
      <button class="lightbox-next" aria-label="Next image">&#8250;</button>
      <img class="lightbox-image" src="" alt="" />
      <div class="lightbox-caption"></div>
      <div class="lightbox-counter"></div>
    </div>
  </div>
  
  <div class="app-container">
    <aside class="sidebar">
      <div class="sidebar-header">
        <h2><a href="/second-brain/">üìö Docs Portal</a></h2>
      </div>
      
      
      <!-- Commit Info Banner -->
      <div class="commit-info-banner">
        <div class="commit-icon">üîÑ</div>
        <div class="commit-details">
          <div class="commit-message" title="PARA update">
            PARA update
          </div>
          <div class="commit-meta">
            <span class="commit-hash">3c7f0eb</span>
            <span class="commit-date">26 seconds ago</span>
          </div>
        </div>
      </div>
      
      
      <!-- Sidebar controls for collapse/expand all -->
      <div class="sidebar-controls">
        <button onclick="collapseAll()" title="Collapse all folders">
          ‚¨ÜÔ∏è Collapse All
        </button>
        <button onclick="expandAll()" title="Expand all folders">
          ‚¨áÔ∏è Expand All
        </button>
      </div>
      
      <nav class="navigation" id="nav-container">
        
        <!-- Navigation will be loaded from navigation.json -->
        <div class="nav-loading">
          <div class="nav-loading-spinner"></div>
          <p>Loading navigation...</p>
        </div>
        
      </nav>
    </aside>
    
    <main class="main-content">
      <div class="content">
        
        <nav class="breadcrumb"><ol><li><a href="/second-brain/">üè† Home</a></li><li><a href="/second-brain/1-projects/">1-projects</a></li><li><a href="/second-brain/1-projects/english-learning-bot/">english-learning-bot</a></li></ol></nav>
        <div class="markdown-content">
          <div class="table-of-contents">
<ul>
<li><a href="#-telegram-net-9">–§—ñ–Ω–∞–ª—å–Ω–∏–π –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó Telegram-–±–æ—Ç–∞ –∑ –Ω–∞–≤—á–∞–Ω–Ω—è –∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—ó (.NET 9)</a></li>
<ul>
<li><a href="#-">üìã –û–≥–ª—è–¥ –ø—Ä–æ—î–∫—Ç—É</a></li>
<li><a href="#-">üìã –¢–∞–±–ª–∏—Ü—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É –ø—Ä–æ—î–∫—Ç—É</a></li>
<li><a href="#-">üèóÔ∏è –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º–∏</a></li>
<li><a href="#-">üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ—î–∫—Ç—ñ–≤</a></li>
<li><a href="#-">üóÇÔ∏è –°—Ö–µ–º–∏ –∫–ª–∞—Å—ñ–≤ —Ç–∞ —ó—Ö –≤–∑–∞—î–º–æ–¥—ñ—è</a></li>
<ul>
<li><a href="#-">–î—ñ–∞–≥—Ä–∞–º–∞ –≤–∑–∞—î–º–æ–¥—ñ—ó –∫–ª–∞—Å—ñ–≤</a></li>
<li><a href="#-">–î—ñ–∞–≥—Ä–∞–º–∞ –ø–æ—Ç–æ–∫—É –¥–∞–Ω–∏—Ö</a></li>
<li><a href="#domain-models">Domain Models</a></li>
<li><a href="#application-services">Application Services</a></li>
<li><a href="#-">–î—ñ–∞–≥—Ä–∞–º–∞ –≤–∑–∞—î–º–æ–¥—ñ—ó –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤ –ø—ñ–¥ —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —É—Ä–æ–∫—É</a></li>
<li><a href="#-">–î—ñ–∞–≥—Ä–∞–º–∞ —Å—Ç–∞–Ω—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</a></li>
</ul>
<li><a href="#-">üéØ –ü—Å–µ–≤–¥–æ–∫–æ–¥ –æ—Å–Ω–æ–≤–Ω–∏—Ö —Å—Ü–µ–Ω</a></li>
<ul>
<li><a href="#onboardingscene">OnboardingScene</a></li>
<li><a href="#lessonscene">LessonScene</a></li>
</ul>
<li><a href="#-">üìÖ –ï—Ç–∞–ø–∏ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó</a></li>
<ul>
<li><a href="#-1-1-2">–ï—Ç–∞–ø 1: –û—Å–Ω–æ–≤–Ω–∞ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–¢–∏–∂–¥–µ–Ω—å 1-2)</a></li>
<li><a href="#-2-3">–ï—Ç–∞–ø 2: –°—Ü–µ–Ω–∞ –∑–Ω–∞–π–æ–º—Å—Ç–≤–∞ (–¢–∏–∂–¥–µ–Ω—å 3)</a></li>
<li><a href="#-3-4">–ï—Ç–∞–ø 3: –°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç–µ–Ω—Ç—É (–¢–∏–∂–¥–µ–Ω—å 4)</a></li>
<li><a href="#-4-5">–ï—Ç–∞–ø 4: –°–∏—Å—Ç–µ–º–∞ –≤—ñ–∫—Ç–æ—Ä–∏–Ω (–¢–∏–∂–¥–µ–Ω—å 5)</a></li>
<li><a href="#-5-6">–ï—Ç–∞–ø 5: –î–æ–¥–∞—Ç–∫–æ–≤—ñ —Ñ—É–Ω–∫—Ü—ñ—ó (–¢–∏–∂–¥–µ–Ω—å 6)</a></li>
</ul>
<li><a href="#-">üöÄ –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –¥–ª—è —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è</a></li>
<ul>
<li><a href="#-">–õ–æ–∫–∞–ª—å–Ω–∞ —Ä–æ–∑—Ä–æ–±–∫–∞</a></li>
<li><a href="#-docker">–ü—Ä–æ–¥–∞–∫—à–Ω (Docker)</a></li>
</ul>
<li><a href="#-mvp">üìä –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø—ñ—Ö—É MVP</a></li>
</ul>
</ul>
</div><h1 id="-telegram-net-9">
        <a href="#-telegram-net-9" class="header-anchor">
          –§—ñ–Ω–∞–ª—å–Ω–∏–π –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó Telegram-–±–æ—Ç–∞ –∑ –Ω–∞–≤—á–∞–Ω–Ω—è –∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—ó (.NET 9)
        </a>
      </h1><hr>
<h2 id="-">
        <a href="#-" class="header-anchor">
          üìã –û–≥–ª—è–¥ –ø—Ä–æ—î–∫—Ç—É
        </a>
      </h2><p><strong>–ú–µ—Ç–∞:</strong> —Å—Ç–≤–æ—Ä–∏—Ç–∏ Telegram-–±–æ—Ç–∞ –¥–ª—è –≤–∏–≤—á–µ–Ω–Ω—è –∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—ó –º–æ–≤–∏ –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏ Clean Architecture –Ω–∞ .NET 9, PostgreSQL —Ç–∞ Docker.</p>
<p><strong>–û—Å–Ω–æ–≤–Ω–∏–π —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª MVP:</strong></p>
<ul>
<li>–°—Ü–µ–Ω–∞ –∑–Ω–∞–π–æ–º—Å—Ç–≤–∞ (–≤–∏–±—ñ—Ä —Ä—ñ–≤–Ω—è A1/A2)</li>
<li>–£—Ä–æ–∫–∏ –∑ Markdown-–∫–æ–Ω—Ç–µ–Ω—Ç–æ–º</li>
<li>–°–∏—Å—Ç–µ–º–∞ –≤—ñ–∫—Ç–æ—Ä–∏–Ω (3 —Ç–∏–ø–∏: Flashcards, Multiple Choice, Typing)</li>
<li>–¢—Ä–µ–∫—ñ–Ω–≥ –ø—Ä–æ–≥—Ä–µ—Å—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</li>
</ul>
<hr>
<h2 id="-">
        <a href="#-" class="header-anchor">
          üìã –¢–∞–±–ª–∏—Ü—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É –ø—Ä–æ—î–∫—Ç—É
        </a>
      </h2><table>
<thead>
<tr>
<th>–ê—Å–ø–µ–∫—Ç</th>
<th>–î–µ—Ç–∞–ª—ñ</th>
<th>–¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó/–Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏</th>
</tr>
</thead>
<tbody><tr>
<td><strong>–ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞</strong></td>
<td>Clean Architecture (Presentation ‚Üí Application ‚Üí Domain ‚Üí Infrastructure)</td>
<td>.NET 9, C# 12</td>
</tr>
<tr>
<td><strong>–ë–∞–∑–∞ –¥–∞–Ω–∏—Ö</strong></td>
<td>PostgreSQL –∑ EF Core</td>
<td>Entity Framework Core 8, Npgsql</td>
</tr>
<tr>
<td><strong>UI/UX</strong></td>
<td>Telegram Bot API</td>
<td>Telegram.Bot SDK</td>
</tr>
<tr>
<td><strong>–ö–æ–Ω—Ç–µ–Ω—Ç</strong></td>
<td>Markdown —Ñ–∞–π–ª–∏ –∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é –º–µ–¥—ñ–∞</td>
<td>Markdig, –≤–ª–∞—Å–Ω–∏–π –ø–∞—Ä—Å–µ—Ä</td>
</tr>
<tr>
<td><strong>–õ–æ–≥—É–≤–∞–Ω–Ω—è</strong></td>
<td>–°—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è</td>
<td>Serilog</td>
</tr>
<tr>
<td><strong>–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü—ñ—è</strong></td>
<td>Docker Compose</td>
<td>Docker, PostgreSQL 15</td>
</tr>
<tr>
<td><strong>–í–µ–±—Ö—É–∫–∏</strong></td>
<td>HTTPS webhook –¥–ª—è Telegram</td>
<td>ASP.NET Core</td>
</tr>
<tr>
<td><strong>–õ–æ–∫–∞–ª—ñ–∑–∞—Ü—ñ—è</strong></td>
<td>–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞/–ê–Ω–≥–ª—ñ–π—Å—å–∫–∞</td>
<td>Resource —Ñ–∞–π–ª–∏</td>
</tr>
<tr>
<td><strong>–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è</strong></td>
<td>Unit —Ç–∞ Integration —Ç–µ—Å—Ç–∏</td>
<td>xUnit, Moq</td>
</tr>
<tr>
<td><strong>CI/CD</strong></td>
<td>GitHub Actions</td>
<td>Docker, Azure DevOps</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>–ö–æ–º–ø–æ–Ω–µ–Ω—Ç</th>
<th>–í—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω—ñ—Å—Ç—å</th>
<th>–ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ</th>
</tr>
</thead>
<tbody><tr>
<td><strong>EnglishBot.Api</strong></td>
<td>Webhook endpoint, DI –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è</td>
<td>Telegram.Bot, ASP.NET Core</td>
</tr>
<tr>
<td><strong>EnglishBot.Application</strong></td>
<td>–ë—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞, —Å—Ü–µ–Ω–∏, —Å–µ—Ä–≤—ñ—Å–∏</td>
<td>Domain, Infrastructure</td>
</tr>
<tr>
<td><strong>EnglishBot.Domain</strong></td>
<td>–î–æ–º–µ–Ω–Ω—ñ –º–æ–¥–µ–ª—ñ, —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∏</td>
<td>-</td>
</tr>
<tr>
<td><strong>EnglishBot.Infrastructure</strong></td>
<td>–ë–î, –∑–æ–≤–Ω—ñ—à–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏, —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó</td>
<td>Domain, EF Core</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>–¢–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç—É</th>
<th>–§–æ—Ä–º–∞—Ç</th>
<th>–û–±—Ä–æ–±–∫–∞</th>
</tr>
</thead>
<tbody><tr>
<td><strong>–¢–µ–∫—Å—Ç</strong></td>
<td>Markdown –∑ HTML</td>
<td>Markdig –ø–∞—Ä—Å–µ—Ä</td>
</tr>
<tr>
<td><strong>–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è</strong></td>
<td>JPG/PNG/WebP</td>
<td>Telegram Bot API</td>
</tr>
<tr>
<td><strong>–ê—É–¥—ñ–æ</strong></td>
<td>MP3/WAV</td>
<td>SendAudio –º–µ—Ç–æ–¥</td>
</tr>
<tr>
<td><strong>–í—ñ–¥–µ–æ</strong></td>
<td>MP4</td>
<td>SendVideo –º–µ—Ç–æ–¥</td>
</tr>
<tr>
<td><strong>–í—ñ–∫—Ç–æ—Ä–∏–Ω–∏</strong></td>
<td>:::quiz –±–ª–æ–∫–∏</td>
<td>–í–ª–∞—Å–Ω–∏–π –ø–∞—Ä—Å–µ—Ä</td>
</tr>
</tbody></table>
<hr>
<h2 id="-">
        <a href="#-" class="header-anchor">
          üèóÔ∏è –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º–∏
        </a>
      </h2><div class="mermaid">graph TB
    A[Telegram Bot API] --> B[EngPortal.Api]
    B --> C[EngPortal.Application]
    C --> D[EngPortal.Domain]
    C --> E[EngPortal.Infrastructure]
    E --> F[PostgreSQL]
    E --> G[Content Service]
    E --> H[File System/Markdown]
    
    subgraph "Presentation Layer"
        B
    end
    
    subgraph "Application Layer"
        C
        I[Scene Manager]
        J[Content Parser]
        K[Quiz Engine]
    end
    
    subgraph "Domain Layer"
        D
        L[User]
        M[Lesson]
        N[Quiz]
        O[UserProgress]
    end
    
    subgraph "Infrastructure Layer"
        E
        G
        P[DbContext]
        Q[Repositories]
    end</div><hr>
<h2 id="-">
        <a href="#-" class="header-anchor">
          üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ—î–∫—Ç—ñ–≤
        </a>
      </h2><pre><code class="hljs language-css">EnglishBot/
‚îú‚îÄ‚îÄ EnglishBot<span class="hljs-selector-class">.Api</span>/             # –í–µ–± API + Webhook
‚îú‚îÄ‚îÄ EnglishBot<span class="hljs-selector-class">.Application</span>/     # –ë—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞ + –°—Ü–µ–Ω–∏
‚îú‚îÄ‚îÄ EnglishBot<span class="hljs-selector-class">.Domain</span>/          # –î–æ–º–µ–Ω–Ω—ñ –º–æ–¥–µ–ª—ñ
‚îú‚îÄ‚îÄ EnglishBot<span class="hljs-selector-class">.Content</span>/         # –ö–æ–Ω—Ç–µ–Ω—Ç —É—Ä–æ–∫—ñ–≤
‚îú‚îÄ‚îÄ EnglishBot<span class="hljs-selector-class">.Infrastructure</span>/  # –ë–î + –ó–æ–≤–Ω—ñ—à–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏
‚îú‚îÄ‚îÄ EnglishBot<span class="hljs-selector-class">.Tests</span>/           # –¢–µ—Å—Ç–∏
‚îî‚îÄ‚îÄ docker-compose<span class="hljs-selector-class">.yml</span>          # Docker –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</code></pre><hr>
<h2 id="-">
        <a href="#-" class="header-anchor">
          üóÇÔ∏è –°—Ö–µ–º–∏ –∫–ª–∞—Å—ñ–≤ —Ç–∞ —ó—Ö –≤–∑–∞—î–º–æ–¥—ñ—è
        </a>
      </h2><h3 id="-">
        <a href="#-" class="header-anchor">
          –î—ñ–∞–≥—Ä–∞–º–∞ –≤–∑–∞—î–º–æ–¥—ñ—ó –∫–ª–∞—Å—ñ–≤
        </a>
      </h3><div class="mermaid">classDiagram
    class BotUser {
        +long TelegramId
        +string FirstName
        +string Level
        +string Language
        +DateTime CreatedAt
        +int Streak
        +bool NotificationsEnabled
        +TimeSpan NotificationTime
        +List~UserProgress~ Progress
        +List~UserQuizResult~ QuizResults
    }

    class UserState {
        +long TelegramId
        +string Scene
        +string DataJson
        +DateTime UpdatedAt
        +BotUser User
    }

    class Lesson {
        +int Id
        +string Title
        +string Level
        +string ContentPath
        +int Order
        +bool IsActive
        +string Description
        +string[] Tags
        +int EstimatedMinutes
        +List~QuizItem~ Quizzes
        +List~UserProgress~ UserProgress
    }

    class QuizItem {
        +int Id
        +int LessonId
        +string Type
        +string Question
        +string[] Options
        +int[] CorrectAnswers
        +string Explanation
        +string MediaUrl
        +int Order
        +Lesson Lesson
        +List~UserQuizResult~ Results
    }

    class UserProgress {
        +int Id
        +long TelegramId
        +int LessonId
        +bool IsCompleted
        +int CurrentBlock
        +int Score
        +int TotalQuizzes
        +DateTime StartedAt
        +DateTime CompletedAt
        +BotUser User
        +Lesson Lesson
    }

    class UserQuizResult {
        +int Id
        +long TelegramId
        +int QuizItemId
        +string UserAnswer
        +bool IsCorrect
        +TimeSpan TimeSpent
        +DateTime AnsweredAt
        +BotUser User
        +QuizItem QuizItem
    }

    class ISceneManager {
        <<interface>>
        +SetSceneAsync(telegramId, sceneName, data)
        +GetCurrentSceneAsync(telegramId)
        +GetSceneDataAsync~T~(telegramId)
    }

    class IContentService {
        <<interface>>
        +ParseLessonAsync(filePath)
        +GetLessonsAsync(level)
        +GetLessonContentAsync(lessonId)
    }

    %% Relationships
    BotUser "1" --> "1" UserState : has
    BotUser "1" --> "*" UserProgress : tracks
    BotUser "1" --> "*" UserQuizResult : has
    
    Lesson "1" --> "*" QuizItem : contains
    Lesson "1" --> "*" UserProgress : has
    
    QuizItem "1" --> "*" UserQuizResult : tracks
    
    ISceneManager ..> UserState : manages
    IContentService ..> Lesson : processes

    class IScene {
        <<interface>>
        +string Name
        +EnterAsync(bot, update, ct)
        +HandleUpdateAsync(bot, update, ct)
        +ExitAsync(bot, update, ct)
    }

    BotUser "1" --> "*" UserProgress : has
    BotUser "1" --> "*" UserQuizResult : creates
    BotUser "1" --> "1" UserState : has state
    
    Lesson "1" --> "*" QuizItem : contains
    Lesson "1" --> "*" UserProgress : tracks
    
    QuizItem "1" --> "*" UserQuizResult : generates results
    
    UserProgress "*" --> "1" Lesson : belongs to
    UserProgress "*" --> "1" BotUser : belongs to user
    
    UserQuizResult "*" --> "1" QuizItem : –≤—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–∞ –ø–∏—Ç–∞–Ω–Ω—è
    UserQuizResult "*" --> "1" BotUser : –≤—ñ–¥–ø–æ–≤—ñ–¥—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

    ISceneManager ..> UserState : —É–ø—Ä–∞–≤–ª—è—î
    IContentService ..> Lesson : –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î
    IScene ..> BotUser : –≤–∑–∞—î–º–æ–¥—ñ—î –∑</div><h3 id="-">
        <a href="#-" class="header-anchor">
          –î—ñ–∞–≥—Ä–∞–º–∞ –ø–æ—Ç–æ–∫—É –¥–∞–Ω–∏—Ö
        </a>
      </h3><div class="mermaid">flowchart TD
    A[Telegram Update] --> B[WebhookController]
    B --> C{Scene Manager}
    C --> D[Current Scene]
    
    D --> E[OnboardingScene]
    D --> F[LessonScene]  
    D --> G[IdleScene]
    
    E --> H[User Repository]
    F --> I[Content Service]
    F --> J[Quiz Service]
    
    I --> K[Lesson Files .md]
    I --> L[Media Files]
    
    H --> M[(PostgreSQL)]
    J --> M
    
    F --> N[Progress Tracking]
    N --> M
    
    G --> O[Command Handler]
    O --> P[Response Builder]
    
    P --> Q[Telegram Bot API]
    Q --> R[User Interface]
    
    style A fill:#e1f5fe
    style M fill:#f3e5f5
    style K fill:#fff3e0
    style R fill:#e8f5e8</div><h3 id="domain-models">
        <a href="#domain-models" class="header-anchor">
          Domain Models
        </a>
      </h3><pre><code class="hljs language-csharp"><span class="hljs-keyword">namespace</span> <span class="hljs-title">EnglishBot.Domain.Entities</span>;

<span class="hljs-comment">// –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –±–æ—Ç–∞</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">BotUser</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">long</span> TelegramId { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span>? FirstName { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span>? Username { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Level { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-string">&quot;A1&quot;</span>; <span class="hljs-comment">// A1, A2, B1, B2</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Language { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-string">&quot;uk&quot;</span>; <span class="hljs-comment">// uk, en</span>
    <span class="hljs-keyword">public</span> DateTime CreatedAt { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = DateTime.UtcNow;
    <span class="hljs-keyword">public</span> DateTime LastActivityAt { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = DateTime.UtcNow;
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Streak { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">bool</span> NotificationsEnabled { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">public</span> TimeSpan NotificationTime { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = TimeSpan.FromHours(<span class="hljs-number">9</span>);
    
    <span class="hljs-comment">// Navigation</span>
    <span class="hljs-keyword">public</span> List&lt;UserProgress&gt; Progress { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-keyword">new</span>();
    <span class="hljs-keyword">public</span> List&lt;UserQuizResult&gt; QuizResults { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-keyword">new</span>();
}

<span class="hljs-comment">// –°—Ç–∞–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —É –±–æ—Ç—ñ</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">UserState</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">long</span> TelegramId { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Scene { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-string">&quot;idle&quot;</span>; <span class="hljs-comment">// idle, onboarding, lesson, quiz</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span>? DataJson { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } <span class="hljs-comment">// –°–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ —Å—Ü–µ–Ω–∏</span>
    <span class="hljs-keyword">public</span> DateTime UpdatedAt { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = DateTime.UtcNow;
    
    <span class="hljs-comment">// Navigation</span>
    <span class="hljs-keyword">public</span> BotUser User { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-literal">default</span>!;
}

<span class="hljs-comment">// –£—Ä–æ–∫</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Lesson</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Id { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Title { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-literal">default</span>!;
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Level { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-string">&quot;A1&quot;</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> ContentPath { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-literal">default</span>!; <span class="hljs-comment">// –®–ª—è—Ö –¥–æ .md —Ñ–∞–π–ª—É</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Order { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">bool</span> IsActive { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">public</span> DateTime CreatedAt { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = DateTime.UtcNow;
    
    <span class="hljs-comment">// –ú–µ—Ç–∞–¥–∞–Ω—ñ</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span>? Description { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span>[]? Tags { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> EstimatedMinutes { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-number">15</span>;
    
    <span class="hljs-comment">// Navigation</span>
    <span class="hljs-keyword">public</span> List&lt;QuizItem&gt; Quizzes { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-keyword">new</span>();
    <span class="hljs-keyword">public</span> List&lt;UserProgress&gt; UserProgress { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-keyword">new</span>();
}

<span class="hljs-comment">// –ü–∏—Ç–∞–Ω–Ω—è –≤—ñ–∫—Ç–æ—Ä–∏–Ω–∏</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">QuizItem</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Id { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> LessonId { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Type { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-literal">default</span>!; <span class="hljs-comment">// flashcard, mcq, typing</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Question { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-literal">default</span>!;
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span>[] Options { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = Array.Empty&lt;<span class="hljs-built_in">string</span>&gt;();
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span>[] CorrectAnswers { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = Array.Empty&lt;<span class="hljs-built_in">int</span>&gt;();
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span>? Explanation { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span>? MediaUrl { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Order { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    
    <span class="hljs-comment">// Navigation</span>
    <span class="hljs-keyword">public</span> Lesson Lesson { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-literal">default</span>!;
    <span class="hljs-keyword">public</span> List&lt;UserQuizResult&gt; Results { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-keyword">new</span>();
}

<span class="hljs-comment">// –ü—Ä–æ–≥—Ä–µ—Å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –ø–æ —É—Ä–æ–∫—É</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">UserProgress</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Id { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">long</span> TelegramId { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> LessonId { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">bool</span> IsCompleted { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> CurrentBlock { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } <span class="hljs-comment">// –Ü–Ω–¥–µ–∫—Å –ø–æ—Ç–æ—á–Ω–æ–≥–æ –±–ª–æ–∫—É —É —É—Ä–æ—Ü—ñ</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Score { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> TotalQuizzes { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> DateTime StartedAt { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = DateTime.UtcNow;
    <span class="hljs-keyword">public</span> DateTime? CompletedAt { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    
    <span class="hljs-comment">// Navigation</span>
    <span class="hljs-keyword">public</span> BotUser User { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-literal">default</span>!;
    <span class="hljs-keyword">public</span> Lesson Lesson { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-literal">default</span>!;
}

<span class="hljs-comment">// –†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ñ–∫—Ç–æ—Ä–∏–Ω–∏</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">UserQuizResult</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Id { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">long</span> TelegramId { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> QuizItemId { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> UserAnswer { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-literal">default</span>!;
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">bool</span> IsCorrect { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> TimeSpan TimeSpent { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> DateTime AnsweredAt { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = DateTime.UtcNow;
    
    <span class="hljs-comment">// Navigation</span>
    <span class="hljs-keyword">public</span> BotUser User { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-literal">default</span>!;
    <span class="hljs-keyword">public</span> QuizItem QuizItem { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-literal">default</span>!;
}</code></pre><h3 id="application-services">
        <a href="#application-services" class="header-anchor">
          Application Services
        </a>
      </h3><pre><code class="hljs language-csharp"><span class="hljs-keyword">namespace</span> <span class="hljs-title">EnglishBot.Application.Services</span>;

<span class="hljs-comment">// –°–µ—Ä–≤—ñ—Å –∫–æ–Ω—Ç–µ–Ω—Ç—É</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IContentService</span>
{
    Task&lt;List&lt;BotMessage&gt;&gt; ParseLessonAsync(<span class="hljs-built_in">string</span> filePath);
    Task&lt;Lesson[]&gt; GetLessonsAsync(<span class="hljs-built_in">string</span> level);
    <span class="hljs-function">Task&lt;<span class="hljs-built_in">string</span>&gt; <span class="hljs-title">GetLessonContentAsync</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> lessonId</span>)</span>;
}

<span class="hljs-comment">// –°—Ü–µ–Ω–∏ –±–æ—Ç–∞</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IScene</span>
{
    <span class="hljs-built_in">string</span> Name { <span class="hljs-keyword">get</span>; }
    <span class="hljs-function">Task <span class="hljs-title">EnterAsync</span>(<span class="hljs-params">ITelegramBotClient bot, Update update, CancellationToken ct</span>)</span>;
    <span class="hljs-function">Task <span class="hljs-title">HandleUpdateAsync</span>(<span class="hljs-params">ITelegramBotClient bot, Update update, CancellationToken ct</span>)</span>;
    <span class="hljs-function">Task <span class="hljs-title">ExitAsync</span>(<span class="hljs-params">ITelegramBotClient bot, Update update, CancellationToken ct</span>)</span>;
}

<span class="hljs-comment">// –ú–µ–Ω–µ–¥–∂–µ—Ä —Å—Ü–µ–Ω</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">ISceneManager</span>
{
    <span class="hljs-function">Task <span class="hljs-title">SetSceneAsync</span>(<span class="hljs-params"><span class="hljs-built_in">long</span> telegramId, <span class="hljs-built_in">string</span> sceneName, <span class="hljs-built_in">object</span>? data = <span class="hljs-literal">null</span></span>)</span>;
    <span class="hljs-function"><span class="hljs-title">Task</span>&lt;<span class="hljs-title">IScene</span>&gt; <span class="hljs-title">GetCurrentSceneAsync</span>(<span class="hljs-params"><span class="hljs-built_in">long</span> telegramId</span>)</span>;
    Task&lt;T?&gt; GetSceneDataAsync&lt;T&gt;(<span class="hljs-built_in">long</span> telegramId) <span class="hljs-keyword">where</span> T : <span class="hljs-keyword">class</span>;
}

<span class="hljs-comment">// –°–µ—Ä–≤—ñ—Å –≤—ñ–∫—Ç–æ—Ä–∏–Ω</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IQuizService</span>
{
    <span class="hljs-function">Task&lt;QuizResult&gt; <span class="hljs-title">ProcessAnswerAsync</span>(<span class="hljs-params"><span class="hljs-built_in">long</span> telegramId, <span class="hljs-built_in">int</span> quizId, <span class="hljs-built_in">string</span> answer</span>)</span>;
    <span class="hljs-function">Task&lt;QuizStatistics&gt; <span class="hljs-title">GetUserStatisticsAsync</span>(<span class="hljs-params"><span class="hljs-built_in">long</span> telegramId</span>)</span>;
}

<span class="hljs-comment">// –¢–∏–ø–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç—É</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">record</span> <span class="hljs-title">BotMessage</span>;
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-title">TextMessage</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> Content, <span class="hljs-built_in">string</span>? ParseMode = <span class="hljs-literal">null</span></span>) : BotMessage</span>;
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-title">PhotoMessage</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> Caption, <span class="hljs-built_in">string</span> ImagePath</span>) : BotMessage</span>;
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-title">AudioMessage</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> Caption, <span class="hljs-built_in">string</span> AudioPath</span>) : BotMessage</span>;
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-title">VideoMessage</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> Caption, <span class="hljs-built_in">string</span> VideoPath</span>) : BotMessage</span>;
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-title">QuizMessage</span>(<span class="hljs-params">
    <span class="hljs-built_in">string</span> Question, 
    <span class="hljs-built_in">string</span>[] Options, 
    <span class="hljs-built_in">int</span>[] CorrectAnswers, 
    <span class="hljs-built_in">string</span>? Explanation,
    <span class="hljs-built_in">string</span> Type = <span class="hljs-string">&quot;mcq&quot;</span>
</span>) : BotMessage</span>;</code></pre><h3 id="-">
        <a href="#-" class="header-anchor">
          –î—ñ–∞–≥—Ä–∞–º–∞ –≤–∑–∞—î–º–æ–¥—ñ—ó –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤ –ø—ñ–¥ —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —É—Ä–æ–∫—É
        </a>
      </h3><div class="mermaid">sequenceDiagram
    participant U as User
    participant TG as Telegram
    participant API as WebhookController
    participant SM as SceneManager
    participant LS as LessonScene
    participant CS as ContentService
    participant QS as QuizService
    participant DB as PostgreSQL

    U->>TG: /lesson
    TG->>API: POST /webhook
    API->>SM: GetCurrentScene(userId)
    SM->>DB: SELECT * FROM UserStates
    DB-->>SM: UserState
    SM-->>API: IdleScene
    
    API->>SM: SetScene(userId, "lesson")
    SM->>DB: INSERT/UPDATE UserStates
    
    API->>LS: EnterAsync(bot, update)
    LS->>CS: GetLessonsAsync(userLevel)
    CS->>DB: SELECT * FROM Lessons WHERE Level = ?
    DB-->>CS: Lesson[]
    CS-->>LS: Available lessons
    
    LS->>CS: ParseLessonAsync(contentPath)
    CS-->>LS: List<BotMessage>
    
    LS->>TG: SendTextMessage (first block)
    TG-->>U: Text content
    
    LS->>TG: SendTextMessage (quiz question + buttons)
    TG-->>U: Quiz with inline keyboard
    
    U->>TG: Click answer
    TG->>API: CallbackQuery
    API->>LS: HandleUpdateAsync(bot, update)
    
    LS->>QS: ProcessAnswerAsync(userId, quizId, answer)
    QS->>DB: INSERT INTO UserQuizResults
    QS-->>LS: QuizResult(isCorrect, explanation)
    
    LS->>TG: AnswerCallbackQuery + SendMessage
    TG-->>U: "‚úÖ Correct!" + explanation
    
    Note over LS,DB: Continue with next block or complete lesson
    
    LS->>DB: UPDATE UserProgress
    LS->>TG: SendMessage (lesson summary)
    TG-->>U: "Lesson completed! Score: X/Y"</div><h3 id="-">
        <a href="#-" class="header-anchor">
          –î—ñ–∞–≥—Ä–∞–º–∞ —Å—Ç–∞–Ω—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
        </a>
      </h3><div class="mermaid">stateDiagram-v2
    [*] --> Idle
    
    Idle --> Onboarding: /start (new user)
    Idle --> Lesson: /lesson
    Idle --> Settings: /settings
    Idle --> Stats: /stats
    
    Onboarding --> SelectLevel: Enter onboarding
    SelectLevel --> SelectLanguage: Level selected
    SelectLanguage --> SetupNotifications: Language selected  
    SetupNotifications --> Idle: Setup complete
    
    Lesson --> LoadContent: Enter lesson scene
    LoadContent --> ShowContent: Content parsed
    ShowContent --> Quiz: Quiz block reached
    ShowContent --> NextBlock: Text/Media block
    NextBlock --> ShowContent: More blocks
    NextBlock --> Complete: No more blocks
    
    Quiz --> WaitAnswer: Quiz displayed
    WaitAnswer --> ProcessAnswer: User answered
    ProcessAnswer --> ShowExplanation: Answer processed
    ShowExplanation --> NextBlock: Continue lesson
    
    Complete --> Summary: Calculate results
    Summary --> Idle: Show summary & return
    
    Settings --> Idle: Settings updated
    Stats --> Idle: Stats shown</div><hr>
<h2 id="-">
        <a href="#-" class="header-anchor">
          üéØ –ü—Å–µ–≤–¥–æ–∫–æ–¥ –æ—Å–Ω–æ–≤–Ω–∏—Ö —Å—Ü–µ–Ω
        </a>
      </h2><h3 id="onboardingscene">
        <a href="#onboardingscene" class="header-anchor">
          OnboardingScene
        </a>
      </h3><pre><code class="hljs language-csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">OnboardingScene</span> : <span class="hljs-title">IScene</span>
{
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">record</span> <span class="hljs-title">OnboardingData</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> Step, <span class="hljs-built_in">string</span>? Level = <span class="hljs-literal">null</span>, <span class="hljs-built_in">string</span>? Language = <span class="hljs-literal">null</span></span>)</span>;
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">EnterAsync</span>(<span class="hljs-params">ITelegramBotClient bot, Update update, CancellationToken ct</span>)</span>
    {
        <span class="hljs-keyword">var</span> chatId = GetChatId(update);
        <span class="hljs-keyword">await</span> bot.SendTextMessageAsync(chatId, 
            <span class="hljs-string">&quot;üéØ –ü—Ä–∏–≤—ñ—Ç! –Ø –¥–æ–ø–æ–º–æ–∂—É —Ç–æ–±—ñ –≤–∏–≤—á–∏—Ç–∏ –∞–Ω–≥–ª—ñ–π—Å—å–∫—É.\n&quot;</span> +
            <span class="hljs-string">&quot;–°–ø–æ—á–∞—Ç–∫—É –æ–±–µ—Ä–µ–º–æ —Ç–≤—ñ–π —Ä—ñ–≤–µ–Ω—å:&quot;</span>,
            replyMarkup: CreateLevelKeyboard());
            
        <span class="hljs-keyword">await</span> _sceneManager.SetSceneDataAsync(GetUserId(update), 
            <span class="hljs-keyword">new</span> OnboardingData(<span class="hljs-string">&quot;select_level&quot;</span>));
    }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">HandleUpdateAsync</span>(<span class="hljs-params">ITelegramBotClient bot, Update update, CancellationToken ct</span>)</span>
    {
        <span class="hljs-keyword">var</span> data = <span class="hljs-keyword">await</span> _sceneManager.GetSceneDataAsync&lt;OnboardingData&gt;(GetUserId(update));
        
        <span class="hljs-keyword">switch</span> (data?.Step)
        {
            <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;select_level&quot;</span>:
                <span class="hljs-keyword">await</span> HandleLevelSelection(bot, update, ct);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;select_language&quot;</span>:
                <span class="hljs-keyword">await</span> HandleLanguageSelection(bot, update, ct);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;setup_notifications&quot;</span>:
                <span class="hljs-keyword">await</span> HandleNotificationSetup(bot, update, ct);
                <span class="hljs-keyword">break</span>;
        }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">HandleLevelSelection</span>(<span class="hljs-params">ITelegramBotClient bot, Update update, CancellationToken ct</span>)</span>
    {
        <span class="hljs-keyword">if</span> (update.CallbackQuery?.Data?.StartsWith(<span class="hljs-string">&quot;level:&quot;</span>) == <span class="hljs-literal">true</span>)
        {
            <span class="hljs-keyword">var</span> level = update.CallbackQuery.Data.Split(<span class="hljs-string">&#x27;:&#x27;</span>)[<span class="hljs-number">1</span>];
            <span class="hljs-keyword">var</span> chatId = update.CallbackQuery.Message!.Chat.Id;
            
            <span class="hljs-keyword">await</span> bot.SendTextMessageAsync(chatId, 
                <span class="hljs-string">&quot;üåç –¢–µ–ø–µ—Ä –æ–±–µ—Ä–µ–º–æ –º–æ–≤—É —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É:&quot;</span>,
                replyMarkup: CreateLanguageKeyboard());
                
            <span class="hljs-keyword">await</span> _sceneManager.SetSceneDataAsync(GetUserId(update), 
                <span class="hljs-keyword">new</span> OnboardingData(<span class="hljs-string">&quot;select_language&quot;</span>, level));
        }
    }
    
    <span class="hljs-comment">// ... —ñ–Ω—à—ñ –º–µ—Ç–æ–¥–∏</span>
}</code></pre><h3 id="lessonscene">
        <a href="#lessonscene" class="header-anchor">
          LessonScene
        </a>
      </h3><pre><code class="hljs language-csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">LessonScene</span> : <span class="hljs-title">IScene</span>
{
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">record</span> <span class="hljs-title">LessonData</span>(<span class="hljs-params">
        <span class="hljs-built_in">int</span> LessonId,
        List&lt;BotMessage&gt; Blocks,
        <span class="hljs-built_in">int</span> CurrentIndex,
        <span class="hljs-built_in">int</span> Score,
        DateTime StartTime</span>)</span>;
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">EnterAsync</span>(<span class="hljs-params">ITelegramBotClient bot, Update update, CancellationToken ct</span>)</span>
    {
        <span class="hljs-keyword">var</span> userId = GetUserId(update);
        <span class="hljs-keyword">var</span> user = <span class="hljs-keyword">await</span> _userRepository.GetByTelegramIdAsync(userId);
        
        <span class="hljs-comment">// –û—Ç—Ä–∏–º—É—î–º–æ –¥–æ—Å—Ç—É–ø–Ω—ñ —É—Ä–æ–∫–∏ –¥–ª—è —Ä—ñ–≤–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</span>
        <span class="hljs-keyword">var</span> lessons = <span class="hljs-keyword">await</span> _contentService.GetLessonsAsync(user.Level);
        <span class="hljs-keyword">var</span> currentLesson = lessons.FirstOrDefault(l =&gt; !IsCompleted(userId, l.Id));
        
        <span class="hljs-keyword">if</span> (currentLesson == <span class="hljs-literal">null</span>)
        {
            <span class="hljs-keyword">await</span> bot.SendTextMessageAsync(GetChatId(update), 
                <span class="hljs-string">&quot;üéâ –¢–∏ –∑–∞–≤–µ—Ä—à–∏–≤ —É—Å—ñ –¥–æ—Å—Ç—É–ø–Ω—ñ —É—Ä–æ–∫–∏! –ü–µ—Ä–µ—Ö–æ–¥—å –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω–∏–π —Ä—ñ–≤–µ–Ω—å.&quot;</span>);
            <span class="hljs-keyword">await</span> _sceneManager.SetSceneAsync(userId, <span class="hljs-string">&quot;idle&quot;</span>);
            <span class="hljs-keyword">return</span>;
        }
        
        <span class="hljs-comment">// –ü–∞—Ä—Å–∏–º–æ –∫–æ–Ω—Ç–µ–Ω—Ç —É—Ä–æ–∫—É</span>
        <span class="hljs-keyword">var</span> blocks = <span class="hljs-keyword">await</span> _contentService.ParseLessonAsync(currentLesson.ContentPath);
        <span class="hljs-keyword">var</span> data = <span class="hljs-keyword">new</span> LessonData(currentLesson.Id, blocks, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, DateTime.UtcNow);
        
        <span class="hljs-keyword">await</span> _sceneManager.SetSceneDataAsync(userId, data);
        <span class="hljs-keyword">await</span> ProcessNextBlock(bot, update, ct, data);
    }
    
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">ProcessNextBlock</span>(<span class="hljs-params">ITelegramBotClient bot, Update update, 
        CancellationToken ct, LessonData data</span>)</span>
    {
        <span class="hljs-keyword">if</span> (data.CurrentIndex &gt;= data.Blocks.Count)
        {
            <span class="hljs-keyword">await</span> CompleteLessonAsync(bot, update, ct, data);
            <span class="hljs-keyword">return</span>;
        }
        
        <span class="hljs-keyword">var</span> currentBlock = data.Blocks[data.CurrentIndex];
        <span class="hljs-keyword">var</span> chatId = GetChatId(update);
        
        <span class="hljs-keyword">switch</span> (currentBlock)
        {
            <span class="hljs-keyword">case</span> TextMessage text:
                <span class="hljs-keyword">await</span> bot.SendTextMessageAsync(chatId, text.Content, 
                    parseMode: text.ParseMode);
                <span class="hljs-keyword">await</span> MoveToNextBlock(bot, update, ct, data);
                <span class="hljs-keyword">break</span>;
                
            <span class="hljs-keyword">case</span> QuizMessage quiz:
                <span class="hljs-keyword">await</span> SendQuizAsync(bot, chatId, quiz, ct);
                <span class="hljs-keyword">break</span>;
                
            <span class="hljs-keyword">case</span> PhotoMessage photo:
                <span class="hljs-keyword">await</span> bot.SendPhotoAsync(chatId, 
                    InputFile.FromUri(photo.ImagePath), 
                    caption: photo.Caption);
                <span class="hljs-keyword">await</span> MoveToNextBlock(bot, update, ct, data);
                <span class="hljs-keyword">break</span>;
                
            <span class="hljs-comment">// ... —ñ–Ω—à—ñ —Ç–∏–ø–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å</span>
        }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">SendQuizAsync</span>(<span class="hljs-params">ITelegramBotClient bot, <span class="hljs-built_in">long</span> chatId, 
        QuizMessage quiz, CancellationToken ct</span>)</span>
    {
        <span class="hljs-keyword">var</span> keyboard = <span class="hljs-keyword">new</span> InlineKeyboardMarkup(
            quiz.Options.Select((option, index) =&gt; 
                <span class="hljs-keyword">new</span>[] { InlineKeyboardButton.WithCallbackData(option, <span class="hljs-string">$&quot;quiz:<span class="hljs-subst">{index}</span>&quot;</span>) })
        );
        
        <span class="hljs-keyword">await</span> bot.SendTextMessageAsync(chatId, 
            <span class="hljs-string">$&quot;‚ùì <span class="hljs-subst">{quiz.Question}</span>&quot;</span>, 
            replyMarkup: keyboard);
    }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">HandleUpdateAsync</span>(<span class="hljs-params">ITelegramBotClient bot, Update update, CancellationToken ct</span>)</span>
    {
        <span class="hljs-keyword">if</span> (update.CallbackQuery?.Data?.StartsWith(<span class="hljs-string">&quot;quiz:&quot;</span>) == <span class="hljs-literal">true</span>)
        {
            <span class="hljs-keyword">await</span> HandleQuizAnswerAsync(bot, update, ct);
        }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">HandleQuizAnswerAsync</span>(<span class="hljs-params">ITelegramBotClient bot, Update update, CancellationToken ct</span>)</span>
    {
        <span class="hljs-keyword">var</span> data = <span class="hljs-keyword">await</span> _sceneManager.GetSceneDataAsync&lt;LessonData&gt;(GetUserId(update));
        <span class="hljs-keyword">var</span> selectedOption = <span class="hljs-built_in">int</span>.Parse(update.CallbackQuery!.Data!.Split(<span class="hljs-string">&#x27;:&#x27;</span>)[<span class="hljs-number">1</span>]);
        <span class="hljs-keyword">var</span> quiz = (QuizMessage)data!.Blocks[data.CurrentIndex];
        
        <span class="hljs-keyword">var</span> isCorrect = quiz.CorrectAnswers.Contains(selectedOption);
        <span class="hljs-keyword">var</span> newScore = isCorrect ? data.Score + <span class="hljs-number">1</span> : data.Score;
        
        <span class="hljs-comment">// –í—ñ–¥–ø–æ–≤—ñ–¥—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–≤—ñ</span>
        <span class="hljs-keyword">await</span> bot.AnswerCallbackQueryAsync(update.CallbackQuery.Id,
            isCorrect ? <span class="hljs-string">&quot;‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ!&quot;</span> : <span class="hljs-string">&quot;‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ&quot;</span>);
            
        <span class="hljs-comment">// –ü–æ—è—Å–Ω–µ–Ω–Ω—è (—è–∫—â–æ —î)</span>
        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">string</span>.IsNullOrEmpty(quiz.Explanation))
        {
            <span class="hljs-keyword">await</span> bot.SendTextMessageAsync(GetChatId(update), 
                <span class="hljs-string">$&quot;<span class="hljs-subst">{(isCorrect ? <span class="hljs-string">&quot;‚úÖ&quot;</span> : <span class="hljs-string">&quot;‚ùå&quot;</span>)}</span> <span class="hljs-subst">{quiz.Explanation}</span>&quot;</span>);
        }
        
        <span class="hljs-comment">// –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç</span>
        <span class="hljs-keyword">await</span> SaveQuizResultAsync(GetUserId(update), selectedOption, isCorrect);
        
        <span class="hljs-comment">// –ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –±–ª–æ–∫—É</span>
        <span class="hljs-keyword">var</span> updatedData = data <span class="hljs-keyword">with</span> { Score = newScore, CurrentIndex = data.CurrentIndex + <span class="hljs-number">1</span> };
        <span class="hljs-keyword">await</span> _sceneManager.SetSceneDataAsync(GetUserId(update), updatedData);
        <span class="hljs-keyword">await</span> ProcessNextBlock(bot, update, ct, updatedData);
    }
}</code></pre><hr>
<h2 id="-">
        <a href="#-" class="header-anchor">
          üìÖ –ï—Ç–∞–ø–∏ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó
        </a>
      </h2><h3 id="-1-1-2">
        <a href="#-1-1-2" class="header-anchor">
          –ï—Ç–∞–ø 1: –û—Å–Ω–æ–≤–Ω–∞ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–¢–∏–∂–¥–µ–Ω—å 1-2)
        </a>
      </h3><p><strong>–ó–∞–≤–¥–∞–Ω–Ω—è:</strong></p>
<ul>
<li><input disabled="" type="checkbox"> –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –ø—Ä–æ—î–∫—Ç—ñ–≤ (.NET 9)</li>
<li><input disabled="" type="checkbox"> –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è EF Core + PostgreSQL</li>
<li><input disabled="" type="checkbox"> –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –¥–æ–º–µ–Ω–Ω–∏—Ö –º–æ–¥–µ–ª–µ–π</li>
<li><input disabled="" type="checkbox"> –ë–∞–∑–æ–≤–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è Docker Compose</li>
<li><input disabled="" type="checkbox"> –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è SceneManager —Ç–∞ –±–∞–∑–æ–≤–∏—Ö —Å—Ü–µ–Ω</li>
<li><input disabled="" type="checkbox"> –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Serilog –¥–ª—è –ª–æ–≥—É–≤–∞–Ω–Ω—è</li>
<li><input disabled="" type="checkbox"> –°—Ç–≤–æ—Ä–µ–Ω–Ω—è webhook endpoint –¥–ª—è Telegram</li>
</ul>
<p><strong>–ö—Ä–∏—Ç–µ—Ä—ñ—ó –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—ñ:</strong></p>
<ul>
<li>–ë–æ—Ç –æ—Ç—Ä–∏–º—É—î —Ç–∞ –æ–±—Ä–æ–±–ª—è—î –±–∞–∑–æ–≤—ñ –∫–æ–º–∞–Ω–¥–∏</li>
<li>–ë–î —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è —Ç–∞ –∑–∞–ø–æ–≤–Ω—é—î—Ç—å—Å—è –ø–æ—á–∞—Ç–∫–æ–≤–∏–º–∏ –¥–∞–Ω–∏–º–∏</li>
<li>–õ–æ–≥–∏ –ø–∏—à—É—Ç—å—Å—è —É –∫–æ–Ω—Å–æ–ª—å —Ç–∞ —Ñ–∞–π–ª</li>
<li>Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—å—Å—è –±–µ–∑ –ø–æ–º–∏–ª–æ–∫</li>
</ul>
<h3 id="-2-3">
        <a href="#-2-3" class="header-anchor">
          –ï—Ç–∞–ø 2: –°—Ü–µ–Ω–∞ –∑–Ω–∞–π–æ–º—Å—Ç–≤–∞ (–¢–∏–∂–¥–µ–Ω—å 3)
        </a>
      </h3><p><strong>–ó–∞–≤–¥–∞–Ω–Ω—è:</strong></p>
<ul>
<li><input disabled="" type="checkbox"> –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è OnboardingScene</li>
<li><input disabled="" type="checkbox"> –°—Ç–≤–æ—Ä–µ–Ω–Ω—è inline-–∫–ª–∞–≤—ñ–∞—Ç—É—Ä –¥–ª—è –≤–∏–±–æ—Ä—É —Ä—ñ–≤–Ω—è</li>
<li><input disabled="" type="checkbox"> –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∏—Ö –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å —É –ë–î</li>
<li><input disabled="" type="checkbox"> –í–∞–ª—ñ–¥–∞—Ü—ñ—è –≤–≤–µ–¥–µ–Ω–∏—Ö –¥–∞–Ω–∏—Ö</li>
<li><input disabled="" type="checkbox"> –õ–æ–∫–∞–ª—ñ–∑–∞—Ü—ñ—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å (—É–∫—Ä–∞—ó–Ω—Å—å–∫–∞/–∞–Ω–≥–ª—ñ–π—Å—å–∫–∞)</li>
</ul>
<p><strong>–ö—Ä–∏—Ç–µ—Ä—ñ—ó –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—ñ:</strong></p>
<ul>
<li>–ù–æ–≤—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –ø—Ä–æ—Ö–æ–¥—è—Ç—å –ø–æ–≤–Ω—É –ø—Ä–æ—Ü–µ–¥—É—Ä—É –∑–Ω–∞–π–æ–º—Å—Ç–≤–∞</li>
<li>–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —É –ë–î</li>
<li>–Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–æ—Å—Ç—É–ø–Ω–∏–π —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é —Ç–∞ –∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—é</li>
</ul>
<h3 id="-3-4">
        <a href="#-3-4" class="header-anchor">
          –ï—Ç–∞–ø 3: –°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç–µ–Ω—Ç—É (–¢–∏–∂–¥–µ–Ω—å 4)
        </a>
      </h3><p><strong>–ó–∞–≤–¥–∞–Ω–Ω—è:</strong></p>
<ul>
<li><input disabled="" type="checkbox"> –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è ContentService –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥—É Markdown</li>
<li><input disabled="" type="checkbox"> –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ —Ä—ñ–∑–Ω–∏—Ö —Ç–∏–ø—ñ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç—É (—Ç–µ–∫—Å—Ç, –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è, –∞—É–¥—ñ–æ)</li>
<li><input disabled="" type="checkbox"> –°–∏—Å—Ç–µ–º–∞ :::quiz –±–ª–æ–∫—ñ–≤ —É markdown</li>
<li><input disabled="" type="checkbox"> –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–∞ –∫–µ—à—É–≤–∞–Ω–Ω—è –º–µ–¥—ñ–∞—Ñ–∞–π–ª—ñ–≤</li>
<li><input disabled="" type="checkbox"> –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —à–∞–±–ª–æ–Ω—ñ–≤ —É—Ä–æ–∫—ñ–≤</li>
</ul>
<p><strong>–ö—Ä–∏—Ç–µ—Ä—ñ—ó –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—ñ:</strong></p>
<ul>
<li>Markdown —Ñ–∞–π–ª–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–∞—Ä—Å—è—Ç—å—Å—è —É BotMessage</li>
<li>–ú–µ–¥—ñ–∞—Ñ–∞–π–ª–∏ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—é—Ç—å—Å—è —É Telegram</li>
<li>–í—ñ–∫—Ç–æ—Ä–∏–Ω–∏ –∑ markdown –ø—Ä–∞—Ü—é—é—Ç—å</li>
</ul>
<h3 id="-4-5">
        <a href="#-4-5" class="header-anchor">
          –ï—Ç–∞–ø 4: –°–∏—Å—Ç–µ–º–∞ –≤—ñ–∫—Ç–æ—Ä–∏–Ω (–¢–∏–∂–¥–µ–Ω—å 5)
        </a>
      </h3><p><strong>–ó–∞–≤–¥–∞–Ω–Ω—è:</strong></p>
<ul>
<li><input disabled="" type="checkbox"> –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è 3 —Ç–∏–ø—ñ–≤ –≤—ñ–∫—Ç–æ—Ä–∏–Ω (MCQ, Flashcards, Typing)</li>
<li><input disabled="" type="checkbox"> LessonScene –∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é mixed-–∫–æ–Ω—Ç–µ–Ω—Ç—É</li>
<li><input disabled="" type="checkbox"> –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É UserQuizResult</li>
<li><input disabled="" type="checkbox"> –°–∏—Å—Ç–µ–º–∞ –æ—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è —Ç–∞ –ø—Ä–æ–≥—Ä–µ—Å—É</li>
<li><input disabled="" type="checkbox"> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</li>
</ul>
<p><strong>–ö—Ä–∏—Ç–µ—Ä—ñ—ó –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—ñ:</strong></p>
<ul>
<li>–£—Å—ñ —Ç–∏–ø–∏ –≤—ñ–∫—Ç–æ—Ä–∏–Ω –ø—Ä–∞—Ü—é—é—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω–æ</li>
<li>–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —É –ë–î</li>
<li>–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –±–∞—á–∏—Ç—å —Å–≤—ñ–π –ø—Ä–æ–≥—Ä–µ—Å</li>
</ul>
<h3 id="-5-6">
        <a href="#-5-6" class="header-anchor">
          –ï—Ç–∞–ø 5: –î–æ–¥–∞—Ç–∫–æ–≤—ñ —Ñ—É–Ω–∫—Ü—ñ—ó (–¢–∏–∂–¥–µ–Ω—å 6)
        </a>
      </h3><p><strong>–ó–∞–≤–¥–∞–Ω–Ω—è:</strong></p>
<ul>
<li><input disabled="" type="checkbox"> –°–∏—Å—Ç–µ–º–∞ –Ω–∞–≥–∞–¥—É–≤–∞–Ω—å (—â–æ–¥–µ–Ω–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è)</li>
<li><input disabled="" type="checkbox"> –ö–æ–º–∞–Ω–¥–∏ /stats, /progress, /help</li>
<li><input disabled="" type="checkbox"> –°–∏—Å—Ç–µ–º–∞ —Å—Ç—Ä—ñ–∫—ñ–≤ (consecutive days)</li>
<li><input disabled="" type="checkbox"> Backup/restore –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∏—Ö –¥–∞–Ω–∏—Ö</li>
<li><input disabled="" type="checkbox"> –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫ —Ç–∞ Rate Limiting</li>
</ul>
<p><strong>–ö—Ä–∏—Ç–µ—Ä—ñ—ó –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—ñ:</strong></p>
<ul>
<li>–ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –ø—Ä–∞—Ü—é—é—Ç—å –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º</li>
<li>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è –∫–æ—Ä–µ–∫—Ç–Ω–æ</li>
<li>–°–∏—Å—Ç–µ–º–∞ –æ–±—Ä–æ–±–ª—è—î –ø–æ–º–∏–ª–∫–∏ gracefully</li>
</ul>
<hr>
<h2 id="-">
        <a href="#-" class="header-anchor">
          üöÄ –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –¥–ª—è —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è
        </a>
      </h2><h3 id="-">
        <a href="#-" class="header-anchor">
          –õ–æ–∫–∞–ª—å–Ω–∞ —Ä–æ–∑—Ä–æ–±–∫–∞
        </a>
      </h3><pre><code class="hljs language-bash"><span class="hljs-comment"># 1. –ö–ª–æ–Ω—É–≤–∞–Ω–Ω—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é</span>
git <span class="hljs-built_in">clone</span> &lt;repository-url&gt;
<span class="hljs-built_in">cd</span> EnglishBot

<span class="hljs-comment"># 2. –ó–∞–ø—É—Å–∫ –ë–î —á–µ—Ä–µ–∑ Docker</span>
docker-compose up -d postgres

<span class="hljs-comment"># 3. –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –º—ñ–≥—Ä–∞—Ü—ñ–π</span>
dotnet ef database update --project EnglishBot.Infrastructure --startup-project EnglishBot.Api

<span class="hljs-comment"># 4. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è appsettings.json</span>
<span class="hljs-comment"># –î–æ–¥–∞—Ç–∏ BOT_TOKEN, WEBHOOK_SECRET, connection string</span>

<span class="hljs-comment"># 5. –ó–∞–ø—É—Å–∫ –ø—Ä–æ—î–∫—Ç—É</span>
dotnet run --project EnglishBot.Api</code></pre><h3 id="-docker">
        <a href="#-docker" class="header-anchor">
          –ü—Ä–æ–¥–∞–∫—à–Ω (Docker)
        </a>
      </h3><pre><code class="hljs language-yaml"><span class="hljs-comment"># docker-compose.prod.yml</span>
<span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3.8&#x27;</span>
<span class="hljs-attr">services:</span>
  <span class="hljs-attr">app:</span>
    <span class="hljs-attr">build:</span> <span class="hljs-string">.</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">ASPNETCORE_ENVIRONMENT=Production</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">ConnectionStrings__Default=Host=postgres;Database=englishbot;Username=postgres;Password=${DB_PASSWORD}</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">Bot__Token=${BOT_TOKEN}</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">Bot__WebhookSecret=${WEBHOOK_SECRET}</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">postgres</span>
    
  <span class="hljs-attr">postgres:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">postgres:15</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">POSTGRES_DB=englishbot</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">POSTGRES_PASSWORD=${DB_PASSWORD}</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">postgres_data:/var/lib/postgresql/data</span>

<span class="hljs-attr">volumes:</span>
  <span class="hljs-attr">postgres_data:</span></code></pre><hr>
<h2 id="-mvp">
        <a href="#-mvp" class="header-anchor">
          üìä –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø—ñ—Ö—É MVP
        </a>
      </h2><ul>
<li><p><strong>–¢–µ—Ö–Ω—ñ—á–Ω—ñ:</strong></p>
<ul>
<li>–ë–æ—Ç –æ–±—Ä–æ–±–ª—è—î 95%+ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –±–µ–∑ –ø–æ–º–∏–ª–æ–∫</li>
<li>–ß–∞—Å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ &lt; 2 —Å–µ–∫—É–Ω–¥</li>
<li>Uptime &gt; 99%</li>
</ul>
</li>
<li><p><strong>–§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ:</strong></p>
<ul>
<li>–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ –ø—Ä–æ–π—Ç–∏ –ø–æ–≤–Ω–∏–π —Ü–∏–∫–ª: –∑–Ω–∞–π–æ–º—Å—Ç–≤–æ ‚Üí —É—Ä–æ–∫ ‚Üí –≤—ñ–∫—Ç–æ—Ä–∏–Ω–∏ ‚Üí —Ä–µ–∑—É–ª—å—Ç–∞—Ç</li>
<li>–ü—Ä–æ–≥—Ä–µ—Å –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –º—ñ–∂ —Å–µ–∞–Ω—Å–∞–º–∏</li>
<li>–°–∏—Å—Ç–µ–º–∞ –ø—ñ–¥—Ç—Ä–∏–º—É—î –º—ñ–Ω—ñ–º—É–º 10 –æ–¥–Ω–æ—á–∞—Å–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</li>
</ul>
</li>
<li><p><strong>UX:</strong></p>
<ul>
<li>–Ü–Ω—Ç—É—ó—Ç–∏–≤–Ω–∞ –Ω–∞–≤—ñ–≥–∞—Ü—ñ—è –±–µ–∑ –∑–∞–π–≤–∏—Ö –∫—Ä–æ–∫—ñ–≤</li>
<li>–®–≤–∏–¥–∫–∏–π —Ñ—ñ–¥–±–µ–∫ –Ω–∞ –¥—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</li>
<li>–ó—Ä–æ–∑—É–º—ñ–ª—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫–∏</li>
</ul>
</li>
</ul>
<hr>
<p><strong>–ì–æ—Ç–æ–≤–æ!</strong> –¶–µ–π –¥–æ–∫—É–º–µ–Ω—Ç –º—ñ—Å—Ç–∏—Ç—å —É—Å–µ –Ω–µ–æ–±—Ö—ñ–¥–Ω–µ –¥–ª—è –ø–æ—á–∞—Ç–∫—É —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó Telegram-–±–æ—Ç–∞ –¥–ª—è –Ω–∞–≤—á–∞–Ω–Ω—è –∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—ó –º–æ–≤–∏. –ú–æ–∂–Ω–∞ –ø–æ—á–∏–Ω–∞—Ç–∏ –∑ –ø–µ—Ä—à–æ–≥–æ –µ—Ç–∞–ø—É —Ç–∞ –ø–æ—Å—Ç—É–ø–æ–≤–æ —Ä–æ–∑—à–∏—Ä—é–≤–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª.</p>

        </div>
      
      </div>
    </main>
  </div>

  <!-- External JavaScript -->
  <script src="/second-brain/app.js"></script>
</body>
</html>
